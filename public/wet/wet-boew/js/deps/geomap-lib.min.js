!function(L,A,l){"use strict";function F(e,t){var o=this,a=[];return this.map=e,this.settings=t,this.id=this.settings.tableId||V(),this.layer=this.createOLLayer(),this.settings.accessible=void 0===this.settings.accessible||this.settings.accessible,this.settings.visible=void 0===this.settings.visible||this.settings.visible,this.settings.zoom=void 0===this.settings.zoom||this.settings.zoom,this.settings.accessible&&this.map.layerDiv.append("<div class='panel panel-default'><div class='panel-heading'><div class='panel-title' role='heading'>"+this.settings.title+"</div></div><div class='panel-body'><div data-layer='"+this.id+"' class='geomap-table-wrapper' style='display:none;'></div></div></div>"),Object.defineProperty(o,"isVisible",{get:function(){return o.visibilityState},set:function(t){o.visibilityState=t,a.forEach(function(e){return e(t)})}}),o.layer?(this.observeVisibility=function(e){a.push(e)},this.observeVisibility(function(e){var t=L("div[ data-layer='"+o.id+"' ].geomap-table-wrapper");e?(t.fadeIn(),t.parent().find(".layer-msg").remove()):(t.fadeOut(),t.parent().append("<div class='layer-msg'><p>"+j.hiddenLayer+"</p></div>").fadeIn()),o.layer.setVisible(o.isVisible)}),0!==this.map.legendDiv.length&&this.addToLegend(),this.isVisible=this.settings.visible,this):null}function v(e,t){var o;return e.getInteractions().forEach(function(e){e instanceof t&&(o=e)}),o}function N(){var e={fill:P(l.drawColours[t],.5),stroke:P(l.drawColours[t],1),transparent:[0,0,0,0]};return(t+=1)===l.drawColours.length&&(t=0),e}function c(){var n,p,c,g,d,o,u,m,y,h,b,f,v=N();this.createStyleFunction=function(e,t){return o=(d=e)&&d.type?d.type:"default",function(e){return"rule"===o?new a(e,t):"symbol"===o?new i:"default"===o?new l(e,t):"unique"===o?new r(e,t):"select"===o?new s(e,t):void 0}};var a=function(e){for(var t,o,a=d.rule,i=a.length,l={EQUAL_TO:function(e,t){return String(e)===String(t[0])},GREATER_THAN:function(e,t){return e>t[0]},LESS_THAN:function(e,t){return e<t[0]},BETWEEN:function(e,t){return e>=t[0]&&e<=t[1]}},r=e&&e.getGeometry()?e.getGeometry().getType():"Polygon",s=0;s!==i;s+=1)if(o=(t=a[s]).filter,b=t.init.strokeDash||[1,0],f=t.init.strokeWidth||1,m=t.init.fillOpacity||t.init.graphicOpacity||.5,y=t.init.pointRadius||5,h=t.init.strokeColor?P(t.init.strokeColor,m):v.transparent,u=P(t.init.fillColor,m),g=t.init.graphicName||null,n=t.init.externalGraphic||null,p=t.init.graphicHeight||25,c=t.init.graphicWidth||25,l[o](e.attributes[t.field],t.value))switch(r){case"Polygon":return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});case"Point":return g?S({symbol:g,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,lineDash:b}),radius:y}):n?k({src:n,opacity:m,size:[c,p]}):C({radius:y,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});case"LineString":return T({stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});default:return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})})}},i=function(){return m=d.init.fillOpacity||d.init.graphicOpacity||1,y=d.init.pointRadius||5,h=d.init.strokeColor?P(d.init.strokeColor,m):v.transparent,u=P(d.init.fillColor,m),g=d.init.graphicName||null,n=d.init.externalGraphic||null,p=d.init.graphicHeight||25,c=d.init.graphicWidth||25,g?S({symbol:d.init.graphicName,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,lineDash:b}),radius:y}):n?k({src:n,opacity:m,size:[c,p]}):C({radius:y,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f})})},l=function(){return m=d.fillOpacity||d.graphicOpacity||1,u=d.fillColor?P(d.fillColor,m):v.transparent,h=d.strokeColor?P(d.strokeColor,m):v.transparent,f=d.strokeWidth||1,b=d.strokeDash||[1,0],[new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b}),radius:5}),fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})})]},r=function(e,t){var o,a,i=d.field;for(o in d.init)switch(a=d.init[o],b=a.strokeDash||[1,0],f=a.strokeWidth||1,m=a.fillOpacity||a.graphicOpacity||.5,y=a.pointRadius||5,h=a.strokeColor?P(a.strokeColor,m):v.transparent,u=a.fillColor?P(a.fillColor,m):null,p=a.graphicHeight||25,n=a.externalGraphic,c=a.graphicWidth||25,t){case"Polygon":if(e.attributes&&e.attributes[i]===o)return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});break;case"Point":if(n){if(e.attributes&&e.attributes[i]===o)return k({src:n,opacity:m,size:[c,p]})}else if(e.attributes&&e.attributes[i]===o)return C({radius:y,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});break;case"LineString":if(e.attributes&&e.attributes[i]===o)return T({stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});break;default:if(e.attributes&&e.attributes[i]===o)return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})})}},s=function(e,t){switch(b=d.strokeDash||[1,0],f=d.strokeWidth||1,m=d.fillOpacity||d.graphicOpacity||.5,y=d.pointRadius||5,h=d.strokeColor?P(d.strokeColor,m):v.transparent,u=d.fillColor?P(d.fillColor,m):null,p=d.graphicHeight||25,n=d.externalGraphic,c=d.graphicWidth||25,t){case"Polygon":return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});case"Point":return n?k({src:n,opacity:m,size:[c,p]}):C({radius:y,fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});case"LineString":return T({stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})});default:return O({fill:new ol.style.Fill({color:u}),stroke:new ol.style.Stroke({color:h,width:f,lineDash:b})})}}}function M(e,t){return"<label class='wb-inv' for='cb_"+t.getId()+"'>"+j.labelSelect+"</label><input type='checkbox' id='cb_"+t.getId()+"' class='geomap-cbx' data-map='"+e.map.id+"' data-layer='"+t.layerId+"' data-feature='"+t.getId()+"' />"}function z(e,t){return"<a href='javascript:;' data-map='"+e.map.id+"' data-layer='"+t.layerId+"' data-feature='"+t.getId()+"' class='btn btn-link geomap-zoomto' alt='"+j.zoomFeature+"' role='button'><span class='glyphicon glyphicon-zoom-in'></span></a>"}function u(e,t,o){if(t){var a=o.getOverlays().getArray()[0],i=L(A.getElementById("popup-geomap-map-"+o.id)),l="",r=G(o,t.layerId);if(t&&t.attributes){var s,n,o=t.getGeometry(),o="Point"===o.getType()?o.getCoordinates():event.mapBrowserEvent.coordinate,p=t.attributes;if(r.popupsInfo)for(s in l+=r.popupsInfo.content,p)Object.prototype.hasOwnProperty.call(p,s)&&(n=new RegExp("_"+s,"igm"),l=l.replace(n,p[s]));else for(s in p)Object.prototype.hasOwnProperty.call(p,s)&&(l+="<tr><th><strong>"+s+"</strong></th><td> "+p[s]+"</td></tr>");i.find(".popup-content").html("<h5>"+t.layerTitle+"</h5><table style='width:100%;'>"+l+"</table>"),a.setPosition(o)}else a.setPosition(void 0)}}function a(p){var e=A.createElement("button"),t=A.createElement("div");e.innerHTML="?",e.title=j.accessTitle,e.setAttribute("type","button"),e.addEventListener("click",function(){var e=A.createElement("div"),t=A.createElement("header"),o=A.createElement("h3"),a=A.createElement("a"),i=A.createElement("div"),l=A.createAttribute("role"),r=A.createAttribute("title"),s=A.createAttribute("href");e.className="panel panel-default geomap-help-dialog ol-control ",t.className="panel-heading",o.innerHTML=j.accessTitle,o.className="panel-title",t.appendChild(o),r.value=j.dismiss,a.setAttributeNode(r),s.value="#",a.setAttributeNode(s),l.value="button",a.setAttributeNode(l),a.innerHTML="&#xd7;<span class='wb-inv'>"+j.dismiss+"</span>",a.className="btn btn-link",e.appendChild(a),i.innerHTML="<p>"+j.access+"</p>",i.className="panel-body",e.appendChild(t),e.appendChild(i);var n=new ol.control.Control({element:e});a.addEventListener("click",function(e){e.preventDefault(),L(e.target).closest(".geomap-help-dialog").fadeOut(function(){p.map.removeControl(n)})}),p.map.addControl(n)},!1),t.className="geomap-help-btn ol-unselectable ol-control",t.appendChild(e),ol.control.Control.call(this,{element:t}),p.map.addControl(this)}function m(d){var e,t=A.createElement("div"),u="setfocus.wb",o=j.geoLocationURL,m={quebec:"<abbr title='Quebec'>QC</abbr>","québec":"<abbr title='Québec'>QC</abbr>","british columbia":"<abbr title='British Columbia'>BC</abbr>","colombie-britannique":"<abbr title='Colombie-Britannique'>BC</abbr>",alberta:"<abbr title='Alberta'>AB</abbr>",saskatchewan:"<abbr title='Saskatchewan'>SK</abbr>",manitoba:"<abbr title='Manitoba'>MB</abbr>",ontario:"<abbr title='Ontario'>ON</abbr>","newfoundland and labrador":"<abbr title='Newfoundland and Labrador'>NL</abbr>","terre-neuve-et-labrador":"<abbr title='Terre-Neuve-et-Labrador'>NL</abbr>","prince edward island":"<abbr title='Prince Edward Island'>PE</abbr>","île-du-prince-édouard":"<abbr title='Île-du-prince-Édouard'>PE</abbr>","nova scotia":"<abbr title='Nova Scotia'>NS</abbr>","nouvelle-écosse":"<abbr title='Nouvelle-Écosse'>NS</abbr>","new brunswick":"<abbr title='New Brunswick'>NB</abbr>","nouveau-brunswick":"<abbr title='Nouveau-Brunswick'>NB</abbr>",yukon:"<abbr title='Yukon'>YT</abbr>","northwest territories":"<abbr title='Northwest Territories'>NT</abbr>","territoires du nord-ouest":"<abbr title='Territoires du Nord-Ouest'>NT</abbr>",nunavut:"<abbr title='Nunavut'>NU</abbr>"},y={"ca.gc.nrcan.geoloc.data.model.Street":"<span class='glyphicon glyphicon-road' aria-hidden='true'></span>","ca.gc.nrcan.geoloc.data.model.Intersection":"<span class='glyphicon glyphicon-road' aria-hidden='true'></span>","ca.gc.nrcan.geoloc.data.model.Geoname":"<span class='glyphicon glyphicon-map-marker' aria-hidden='true'></span>","ca.gc.nrcan.geoloc.data.model.PostalCode":"<span class='glyphicon glyphicon-envelope' aria-hidden='true'></span>","ca.gc.nrcan.geoloc.data.model.NTS":"<span class='glyphicon glyphicon-globe' aria-hidden='true'></span>"};function h(e,t){var o,a,i,l,r=[],s=new ol.proj.Projection({code:"EPSG:4326"}),n=d.map.getView().getProjection();if(G(d.map,"locLayer").getSource().clear(!0),e&&void 0!==e){for(l=e.split(","),i=(o=D(parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]))).length-1;-1!==i;--i)r.push([o[i].getCoordinates()[0],o[i].getCoordinates()[1]]);a=new ol.Feature({geometry:new ol.geom.Polygon([r]).transform(s,n)}),G(d.map,"locLayer").getSource().addFeature(a),d.map.getView().fit(a.getGeometry().getExtent(),d.map.getSize())}else t&&void 0!==t&&(l=0===d.map.getView().getZoom()?12:d.map.getView().getZoom(),a=new ol.Feature({geometry:new ol.geom.Point(t.split(",")).transform(s,n)}),G(d.map,"locLayer").getSource().addFeature(a),d.map.getView().setZoom(l),d.map.getView().setCenter(a.getGeometry().getCoordinates()))}function b(e){var t=e.nextSibling.firstChild;v(d.map,ol.interaction.KeyboardPan).setActive(!0),t.className+=" hide",t.innerHTML="",t.setAttribute("aria-hidden","true"),e.setAttribute("aria-expanded","false"),e.setAttribute("aria-activedescendent","")}function f(e,t){var p="",c=L("#wb-geomap-geocode-search-"+d.id),g=L("#wb-geomap-geoloc-al-"+d.id);(!t||t.length<3)&&g.empty(),L.ajax({type:"GET",url:o,data:{q:t+"*"},success:function(e){if(0<e.length){for(var t,o,a,i,l,r,s=e.length,n=0;n!==s;n+=1)i=(o=e[n]).title.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l=o.bbox?o.bbox[0]+", "+o.bbox[1]+", "+o.bbox[2]+", "+o.bbox[3]:"",r=o.geometry&&"Point"===o.geometry.type?o.geometry.coordinates[0]+", "+o.geometry.coordinates[1]:"",t=y[o.type]||"<span class='glyphicon glyphicon-map-marker' aria-hidden='true'></span>",a=(i=function(e,t){var o=new RegExp(Object.keys(t).join("|"),"gi");return e.replace(o,function(e){return t[e.toLowerCase()]})}(i,m)).replace(/<(?:.|\n)*?>/gm,""),p+="<li id='al-opt-"+d.id+"-"+n+"' class='al-opt' data-lat-lon='"+r+"' data-bbox='"+l+"' data-type='"+o.type+"'><a href='javascript:;' tabindex='-1'>"+t+"<span class='al-val'>"+i+"</span><span class='al-lbl wb-inv' aria-hidden='true'>"+a+"</span></a></li>";g.empty().append(p),g.removeClass("hide").attr("aria-hidden","false"),c.attr("aria-expanded","true"),L(".al-opt a").on("keydown click",function(e){var t,o,a,i,l=e.target,r=e.type,s=e.which;switch(r){case"keydown":if(!e.ctrlKey&&!e.metaKey)return function(e,t){var o,a,i,l=t.parentNode.parentNode,r=l.parentNode.previousSibling,s=L(r);if(!(event.ctrlKey||event.altKey||event.metaKey))return 32===e||47<e&&e<91||95<e&&e<112||159<e&&e<177||187<e&&e<223?(r.value+=String.fromCharCode(e),s.trigger(u),f(0,r.value),!1):8===e?(a=r.value,0!==(i=a.length)&&(r.value=a.substring(0,i-1),f(0,r.value)),s.trigger(u),!1):13===e?(i=t.getElementsByTagName("span"),a=i[2].innerHTML,r.value=a,h(t.parentNode.getAttribute("data-bbox"),t.parentNode.getAttribute("data-lat-lon")),s.trigger(u),b(r),!1):9===e||27===e?(s.trigger(u),b(r),!1):38===e||40===e?(38===e?(o=t.parentNode.previousSibling)||(e=l.getElementsByTagName("li"),o=e[e.length-1]):o=(o=t.parentNode.nextSibling)||l.getElementsByTagName("li")[0],o=o.getElementsByTagName("a")[0],r.setAttribute("aria-activedescendent",o.parentNode.getAttribute("id")),L(o).trigger(u),!1):void 0}(s,l);break;case"click":if(!s||1===s)return o="a"===(t=l).nodeName.toLowerCase()?t:t.parentNode,a=o.parentNode.parentNode.parentNode.previousSibling,i=L(a),t=o.getElementsByTagName("span")[2].innerHTML,a.value=t,h(o.parentNode.getAttribute("data-bbox"),o.parentNode.getAttribute("data-lat-lon")),i.trigger(u),b(a),!1}})}else g.empty(),g.addClass("hide").attr("aria-hidden","true"),g.attr("aria-expanded","false")},dataType:"json",cache:!1})}t.innerHTML="<label for='wb-geomap-geocode-search-"+d.id+"' class='wb-inv'>"+j.geoCoderLabel+"</label><input type='text' class='form-control' id='wb-geomap-geocode-search-"+d.id+"' placeholder='"+j.geoCoderPlaceholder+"' ></input><div class='wb-geomap-geoloc-al-cnt'><ul role='listbox' id='wb-geomap-geoloc-al-"+d.id+"' class='wb-geomap-geoloc-al hide' aria-hidden='true' aria-live='polite'></ul></div>",t.className="geomap-geoloc ol-unselectable ol-control",ol.control.Control.call(this,{element:t}),d.map.addControl(this),L("#wb-geomap-geocode-search-"+d.id).attr("autocomplete","off"),L("#wb-geomap-geocode-search-"+d.id).attr("role","textbox"),L("#wb-geomap-geocode-search-"+d.id).attr("aria-haspopup","true"),L("#wb-geomap-geocode-search-"+d.id).attr("aria-autocomplete","list"),L("#wb-geomap-geocode-search-"+d.id).attr("aria-owns","wb-geomap-geoloc-al-"+d.id),L("#wb-geomap-geocode-search-"+d.id).attr("aria-activedescendent",""),t=768<(e=parseFloat(L(".geomap-geoloc").parent().width()))?.6:.8,x?(L(".geomap-geoloc").css({width:e-10+"px"}),L(".wb-geomap-geoloc-al-cnt").css({width:e-10+"px"})):(L(".geomap-geoloc").css({width:e*t}),L(".wb-geomap-geoloc-al-cnt").css({width:e*t})),w.on("keydown","#wb-geomap-geocode-search-"+d.id,function(e){v(d.map,ol.interaction.KeyboardPan).setActive(!1);var t=e.which;if(!e.ctrlKey&&!e.metaKey)return function(e,t){var o=t.target,a=o.nextSibling.firstChild,i=-1!==a.className.indexOf("hide");if(!(t.ctrlKey||t.altKey||t.metaKey))if(32===e||47<e&&e<91||95<e&&e<112||159<e&&e<177||187<e&&e<223)t.altKey||f(0,o.value+String.fromCharCode(e));else if(8!==e||t.altKey){if((38===e||40===e)&&""===o.getAttribute("aria-activedescendent"))return i&&f(),0===(a=a.getElementsByTagName("a")).length||(a=a[38===e?a.length-1:0],o.setAttribute("aria-activedescendent",a.parentNode.getAttribute("id")),L(a).trigger(u)),!1;i||9!==e&&27!==e&&(27!==e||t.altKey)||b(o)}else e=o.value,0!==(t=e.length)&&f(0,e.substring(0,t-1))}(t,e)})}function y(e){var t,o,a,i,l=e||{},r=this;function s(){return o=new ol.Feature,t=new ol.Feature,o.setStyle(C({radius:6,fill:new ol.style.Fill({color:"#3399CC"}),stroke:new ol.style.Stroke({color:"#fff",width:2})})),[t,o]}L("body").append("<section id='overlay-location-error' class='wb-overlay modal-content overlay-def wb-bar-t bg-danger'><header><h2 class='modal-title'>Geolocation error.</h2></header></section>"),L("#overlay-location-error").trigger("wb-init.wb-overlay"),(a=A.createElement("button")).setAttribute("type","button"),a.setAttribute("title",j.geolocBtn),a.innerHTML="<span class='glyphicon glyphicon-screenshot'></span>",(e=A.createElement("div")).className="ol-geolocate ol-unselectable ol-control",e.appendChild(a),r.geolocation=new ol.Geolocation(l),ol.control.Control.call(this,{element:e,target:l.target}),r.geolocation.on("change:accuracyGeometry",function(){t.setGeometry(r.geolocation.getAccuracyGeometry())}),r.geolocation.on("change:position",function(){i=r.geolocation.getPosition(),o.setGeometry(i?new ol.geom.Point(i):null);var e=r.featuresOverlay.getSource().getExtent();r.getMap().getView().fit(e,r.getMap().getSize()),L(a).html("<span style='color:#3399CC;' class='glyphicon glyphicon-screenshot'></span>")}),r.geolocation.on("error",function(e){2===e.code?L("#overlay-location-error h2.modal-title").text(j.geolocUncapable):L("#overlay-location-error h2.modal-title").text(j.geolocFail),L("#overlay-location-error").trigger("open.wb-overlay")}),a.addEventListener("click",function(){L(this).html("<span style='font-size:.9em;' class='glyphicon glyphicon-refresh glyphicon-spin'></span>"),void 0===r.featuresOverlay?(r.featuresOverlay=new ol.layer.Vector({map:r.getMap(),source:new ol.source.Vector({})}),r.featuresOverlay.getSource().addFeatures(s()),r.geolocation.setTracking(!0)):0===r.featuresOverlay.getSource().getFeatures().length?(r.featuresOverlay.getSource().addFeatures(s()),r.geolocation.setTracking(!0)):(r.geolocation.setTracking(!1),r.featuresOverlay.getSource().clear(),L(this).html("<span class='glyphicon glyphicon-screenshot'></span>"))},!1)}function r(e){var t,o=E(e.getAttribute("data-map"));return e.getAttribute("data-layer")?(t=G(o.map,e.getAttribute("data-layer")),[o.map,t,e.getAttribute("data-feature")?t.getSource().getFeatureById(e.getAttribute("data-feature")):null]):[o.map,null,null]}var s,j,i,n="wb-geomap",p="."+n,w=l.doc,t=0,g=[],x=!1,d={overlays:[],tables:[],useScaleLine:!1,useMousePosition:!1,useLegend:!1,useMapControls:!0,useGeocoder:!1,useGeolocation:!1,useAOI:!1},h=function(e){var t,o=e.target;this.id=o.attr("id"),this.mapLayers=[],this.layerDiv=o.find(".wb-geomap-layers").attr("id","geomap-layers-"+this.id),this.legendDiv=o.find(".wb-geomap-legend").attr("id","geomap-legend-"+this.id),this.mapDiv=o.find(".wb-geomap-map").attr("id","geomap-map-"+this.id),this.settings=e.settings,this.settings.aspectRatio=this.settings.basemap&&this.settings.basemap.mapOptions&&void 0!==this.settings.basemap.mapOptions.aspectRatio?this.settings.basemap.mapOptions.aspectRatio:.8,this.map=f(this),this.legend=new b(this),t=this.addBasemap(),this.map.setView(new ol.View(t)),this.addMapLayers(),t.extent&&this.map.getView().fit(t.extent,this.map.getSize());var l=this.mapLayers;this.map.getLayersByName=function(e){for(var t,o=l.length,a={popup:{visible:function(){return!0}},geometry:{bounds:ol.proj.transform(this.getOverlays().getArray()[0].getPosition(),"EPSG:3978","EPSG:4326")}},i=0;i!==o;i+=1)if((t=l[i]).id&&t.id===e)return[{features:[a]}]},this.loadControls(),this.accessibilize(),this.createPopup(),w.on("wb-ready.wb-geomap","#"+this.id,function(){L("#"+this.id).find(".geomap-progress").remove()})},b=function(e){return this.map=e,this.symbolMapArray=[],this.target=L("#"+e.id+".wb-geomap").find(".wb-geomap-legend"),this.target.attr("id","geomap-legend-"+e.id),this.target.empty(),this},S=function(e){return{square:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:4,radius:e.radius,angle:Math.PI/4})})],triangle:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:3,radius:e.radius,rotation:Math.PI/4,angle:0})})],star:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:5,radius:e.radius,radius2:.4*e.radius,angle:0})})],cross:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:4,radius:e.radius,radius2:0,angle:0})})],x:[new ol.style.Style({image:new ol.style.RegularShape({fill:e.fill,stroke:e.stroke,points:4,radius:e.radius,radius2:0,angle:Math.PI/4})})]}[e.symbol]},k=function(e){return[new ol.style.Style({image:new ol.style.Icon({opacity:e.opacity,src:e.src,size:e.size})})]},C=function(e){return[new ol.style.Style({image:new ol.style.Circle({radius:e.radius,fill:e.fill,stroke:e.stroke})})]},O=function(e){return[new ol.style.Style({fill:e.fill,stroke:e.stroke})]},T=function(e){return[new ol.style.Style({stroke:e.stroke})]},P=function(e,t){var o=(e+"").trim(),a=null,i=o.match(/^#?(([0-9a-zA-Z]{3}){1,3})$/),t=t||1;return i?(6===(o=i[1]).length?a=[parseInt(o.substring(0,2),16),parseInt(o.substring(2,4),16),parseInt(o.substring(4,6),16),t]:3===o.length&&(a=[parseInt(o.substring(0,1)+o.substring(0,1),16),parseInt(o.substring(1,2)+o.substring(1,2),16),parseInt(o.substring(2,3)+o.substring(2,3),16),t]),a):e},f=function(o){var e=o.settings.useMapControls?ol.control.defaults({attributionOptions:{collapsible:!1}}):[],t=o.settings.useMapControls?ol.interaction.defaults({mouseWheelZoom:!0}):[];proj4.defs("EPSG:3978","+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"),proj4.defs("urn:ogc:def:crs:OGC:1.3:CRS84",proj4.defs("EPSG:4326"));var a=new ol.Map({controls:e,interactions:t,logo:!1,target:o.mapDiv.attr("id")}),t=v(a,ol.interaction.MouseWheelZoom);o.settings.useMapControls&&t&&t.setActive(!1),o.mapDiv.height(o.mapDiv.width()*o.settings.aspectRatio),a.set("aspectRatio",o.settings.aspectRatio),a.id=o.id,a.once("postrender",function(){a.getLayer=function(e){var t,o,a=A.querySelector(e+" [data-geometry][data-type]"),e=a.dataset.geometry;return"wkt"===a.dataset.type&&-1!==e.indexOf("POINT")&&(e=(e=(e=e.replace(/,/,"")).substring(e.indexOf("(")+1,e.indexOf(")"))).split(" "),t=parseFloat(e[0]),o=parseFloat(e[1])),{getDataExtent:function(){return[t,o]}}},a.zoomToExtent=function(e){a.getView().setCenter(ol.proj.transform([e[0],e[1]],"EPSG:4326","EPSG:3978")),a.getView().setZoom(5)},l.ready(L("#"+o.id),n,[a])}),a.on("moveend",function(){L(o.id).trigger("wb-updated"+p,[o.map])}),o.mapDiv.append("<div id='tooltip_"+o.id+"' style='display:none;'><span class='tooltip-txt'></span></div>");return a.on("pointermove",function(e){i=L("#tooltip_"+o.id),e.dragging?i.hide():function(e){i=L("#tooltip_"+o.id);var t=L("#tooltip_"+o.id+" span.tooltip-txt");i.css({left:e[0]+"px",top:e[1]-15+"px",position:"absolute"}),(e=a.forEachFeatureAtPixel(e,function(e){return e}))&&e.tooltip?(i.hide(),t.html(e.tooltip),i.show()):i.hide()}(a.getEventPixel(e.originalEvent))}),a},E=function(e){for(var t,o=g.length-1;-1!==o;--o)if((t=g[o]).id===e)return t},I=function(e,t,o){for(var a=[],i=new ol.proj.Projection({code:"EPSG:4326"}),l=e.map.getView().getProjection(),r=D(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),s=r.length-1;-1!==s;--s)a.push([r[s].getCoordinates()[0],r[s].getCoordinates()[1]]);return l=new ol.Feature({geometry:new ol.geom.Polygon([a]).transform(i,l)}),o||G(e.map,"locLayer").getSource().addFeature(l),l},D=function(e,t,o,a){var i,l=parseFloat(e),r=parseFloat(t),s=parseFloat(o),n=parseFloat(a),p=[];if(0===l.length||0===r.length||0===s.length||0===n.length)return!1;for(-180===l&&(l+=.1),180===s&&(s=-5),90===n&&(n-=3),-90===r&&(r=35),i=l;i<s;i+=.5)p.push(new ol.geom.Point([i,r]));for(p.push(new ol.geom.Point([s,r])),i=s;l<i;i-=.5)p.push(new ol.geom.Point([i,n]));return p.push(new ol.geom.Point([l,n])),p.push(new ol.geom.Point([l,r])),p},G=function(e,t){var o;return e.getLayers().forEach(function(e){t===e.id&&(o=e)}),o},V=function(){return Math.random().toString(36).slice(2)};w.on("click",".geomap-zoomto",function(e){var t,o,a=e.which,i="A"===e.target.tagName?e.target:L(e.target).closest("a")[0];a&&1!==a||(e.preventDefault(),t=i.getAttribute("data-map"),e=(a=(o=r(i))[2].getGeometry()).getExtent(),i=o[0].getView(),"Point"===a.getType()?(i.fit(e,o[0].getSize()),i.setZoom(10)):i.fit(e,o[0].getSize()),L("#"+t+" .wb-geomap-map").trigger("setfocus.wb"))}),w.on("geomap.wb",p,function(e){var t,o=e.target,a=o.className.split(/\s+/),i={};/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(x=!0),e.currentTarget===o&&(t=L(o),j||(s=l.i18n,j={add:s("add"),close:s("close"),colon:s("colon"),err:s("err"),hiddenLayer:s("geo-hdnlyr"),toggleLayer:s("geo-tgllyr"),labelSelect:s("geo-lblsel"),select:s("geo-sel"),zoomFeature:s("geo-zmfeat"),zoomin:s("geo-zmin"),zoomout:s("geo-zmout"),zoomworld:s("geo-zmwrld"),baseMapTitle:s("geo-bmapttl"),baseMapURL:s("geo-bmap-url"),baseMapMatrixSet:s("geo-bmap-matrix-set"),scaleline:s("geo-sclln"),mouseposition:s("geo-msepos"),access:s("geo-ally"),accessTitle:s("geo-allyttl"),attribLink:s("geo-attrlnk"),attribTitle:s("geo-attrttl"),ariaMap:s("geo-ariamap"),geoLocationURL:s("geo-locurl-geogratis"),geoCoderPlaceholder:s("geo-loc-placeholder"),geoCoderLabel:s("geo-loc-label"),aoiNorth:s("geo-aoi-north"),aoiEast:s("geo-aoi-east"),aoiSouth:s("geo-aoi-south"),aoiWest:s("geo-aoi-west"),aoiInstructions:s("geo-aoi-instructions"),aoiTitle:s("geo-aoi-title"),aoiBtnDraw:s("geo-aoi-btndraw"),aoiBtnClear:s("geo-aoi-btnclear"),aoiBtnClose:s("close"),geolocBtn:s("geo-geoloc-btn"),geolocFail:s("geo-geoloc-fail"),geolocUncapable:s("geo-geoloc-uncapable"),geoLgndGrphc:s("geo-lgnd-grphc"),dismiss:s("dismiss")}),a={useScaleLine:-1!==a.indexOf("scaleline")||void 0,useMousePosition:-1!==a.indexOf("position")||void 0,useLegend:-1!==a.indexOf("legend"),useMapControls:-1===a.indexOf("static"),useGeocoder:-1!==a.indexOf("geocoder"),useGeolocation:-1!==a.indexOf("geolocation"),useAOI:-1!==a.indexOf("aoi"),useAOIOpen:-1!==a.indexOf("aoi-open")},L.extend(i,d,a,l.getData(t,n)),i.layersFile?L.ajax({url:i.layersFile,async:!0,dataType:"script",success:function(){(i=L.extend(i,wet_boew_geomap))&&i.basemap&&i.basemap.type&&"xyz"===i.basemap.type&&(i.basemap.type="osm"),o.geomap=new h({target:t,settings:i}),g.push(o.geomap)}}):(o.geomap=new h({target:t,settings:i}),g.push(o.geomap))),l.getMap=function(e){return E(e)},l.getLayer=function(e,t){return G(e,t)}}),w.on(l.resizeEvents,function(i){g.forEach(function(e){var t=L(e.map.getTargetElement()),o=t.find(".geomap-geoloc"),a=t.width();t.height(a*e.map.get("aspectRatio")),e.map.updateSize(),o&&("mediumview"===i.type||"largeview"===i.type||"xlargeview"===i.type?o.css({width:"60%"}):o.css({width:"80%"}))})}),w.on("change",".geomap-cbx",function(e){var t=e.target,o=r(t)[2],e=r(t)[0],e=v(e,ol.interaction.Select);t.checked?e.getFeatures().push(o):e.getFeatures().remove(o)}),w.on("focusin focusout mouseover mouseout",".wb-geomap-map",function(e){var t=e.currentTarget,o=e.type,a=t.className.indexOf("active"),i=E(t.getAttribute("data-map")),e=v(i.map,ol.interaction.MouseWheelZoom);i.settings.useMapControls&&e.setActive(!1),"mouseover"===o||"focusin"===o?(a&&L(t).addClass("active"),"focusin"===o&&i.settings.useMapControls&&e.setActive(!0)):0<a&&L(t).removeClass("active")}),h.prototype.addBasemap=function(){var e,t,o,a,i,l=this,r=l.settings.basemap,s=r&&0!==r.length,n={},p=[],c={},g=[];if(l.settings.attribution&&(c.attributions=[new ol.Attribution({html:l.settings.attribution.text})]),s)n.extent=r.mapOptions&&r.mapOptions.maxExtent?r.mapOptions.maxExtent.split(",").map(Number):null,n.projection=r.mapOptions&&r.mapOptions.projection?r.mapOptions.projection:"EPSG:3857",n.center=l.settings&&l.settings.center?ol.proj.transform(l.settings.center,"EPSG:4326",n.projection):r.mapOptions&&r.mapOptions.center?ol.proj.transform(r.mapOptions.center,"EPSG:4326",n.projection):r.mapOptions&&r.mapOptions.maxExtent?ol.extent.getCenter(n.extent):[0,0],n.zoom=l.settings&&l.settings.zoom?l.settings.zoom:r.mapOptions&&r.mapOptions.zoomLevel?r.mapOptions.zoomLevel:2,"wms"===r.type?((s=function(e,t){var o,a={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&L.inArray(o,t)<0&&(a[o]=e[o]);return a}(r,["mapOptions","url"])).srs=n.projection,s.crs=n.projection,g.push(new ol.layer.Image({extent:n.extent,source:new ol.source.ImageWMS({url:r.url,params:s})}))):"esri"===r.type?(c.url=r.url.replace("/MapServer/export","/MapServer"),g.push(new ol.layer.Tile({extent:n.extent,source:new ol.source.TileArcGISRest(c)}))):"xyz"===r.type?(L.isArray(r.url)?(L.each(r.url,function(e,t){p.push(t.replace(/\${/g,"{"))}),c.urls=p):c.url=r.url.replace(/\${/g,"{"),g.push(new ol.layer.Tile({source:new ol.source.XYZ(c)}))):"osm"===r.type?g.push(new ol.layer.Tile({source:new ol.source.OSM({attributions:[ol.source.OSM.ATTRIBUTION]})})):"mapquest"===r.type&&g.push(new ol.layer.Tile({source:new ol.source.MapQuest({layer:"sat"})}));else{for(c=ol.proj.get("EPSG:3978"),t=[38364.660062653464,22489.62831258996,13229.193125052918,7937.5158750317505,4630.2175937685215,2645.8386250105837,1587.5031750063501,926.0435187537042,529.1677250021168,317.50063500127004,185.20870375074085,111.12522225044451,66.1459656252646,38.36466006265346,22.48962831258996,13.229193125052918,7.9375158750317505,4.6302175937685215],o=5,260<(r=this.mapDiv.width())&&r<=500?o=1:500<r&&r<=725?o=2:725<r&&r<=1175?o=3:1175<r&&r<=2300&&(o=4),a=o-1;-1!==a;--a)t.shift();for(i=new Array(t.length),e=0;e<t.length;++e)i[e]=o+e;n={extent:[-275e4,-9e5,36e5,463e4],resolutions:t,projection:c},g.push(new ol.layer.Tile({source:new ol.source.WMTS({attributions:[new ol.Attribution({html:"<a href='"+j.attribLink+"'>"+j.attribTitle+"</a>"})],url:j.baseMapURL,layer:j.baseMapTitle,matrixSet:j.baseMapMatrixSet,projection:c,tileGrid:new ol.tilegrid.WMTS({extent:[-275e4,-9e5,36e5,463e4],origin:[-34655800,3931e4],resolutions:t,matrixIds:i}),style:"default"})}))}for(var d=g.length-1;-1!==d;--d)l.map.addLayer(g[d]);return function(e){var t,o={};for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&null!==e[t]&&(o[t]=e[t]);return o}(n)},F.prototype.addToLegend=function(){var t,e,o=this,a=this.map.legend.target,i=a.find("fieldset");0===i.length&&(i=L("<fieldset name='legend'><legend class='wb-inv'>"+j.toggleLayer+"</legend></fieldset>").appendTo(a)),e=this.isVisibile?"checked='checked'":"",0===(a=a.find("ul.geomap-lgnd")).length&&(a=L("<ul class='list-unstyled geomap-lgnd'></ul>").appendTo(i)),t=L("<input type='checkbox' id='cb_"+this.id+"' class='geomap-lgnd-cbx' value='"+this.id+"' "+e+" data-map='"+this.map.id+"' data-layer='"+this.id+"' />"),o.observeVisibility(function(e){L("#sb_"+o.id).toggle(e),o.map.legend.refresh(),t.get(0).checked=e}),t.change(function(){o.isVisible=L(this).is(":checked")}),e=L("<label>",{for:"cb_"+this.id,text:this.settings.title}).prepend(t),e=L("<li class='checkbox geomap-lgnd-layer'>").append(e,"<div id='sb_"+this.id+"'></div>"),a.append(e),this.settings.options&&this.settings.options.legendUrl?L("#sb_"+this.id).append("<img src='"+this.settings.options.legendUrl+"' alt='"+j.geoLgndGrphc+"'/>"):this.settings.options&&this.settings.options.legendHTML?L("#sb_"+this.id).append(this.settings.options.legendHTML):"wms"!==this.settings.type&&"esritile"!==this.settings.type&&this.map.legend.symbolize(this)},h.prototype.addTabularData=function(){for(var e,t,o,a,i,l,r,s,n,p,c,g,d,u,m,y,h,b,f,v,w,x,S,k="<span class='wb-inv'>"+j.zoomFeature+"</span>",C="<span class='wb-inv'>"+j.select+"</span>",O=new ol.format.WKT,T=/<\/?[^>]+>/gi,P=/\W/g,E=this.settings.tables.length-1;-1!==E;--E)if(i=A.getElementById(this.settings.tables[E].id)){for(e=L(i).wrap("<div data-layer='"+this.settings.tables[E].id+"' class='geomap-table-wrapper'></div>"),t=this.settings.tables[E],o=[],a=[],l=i.getElementsByTagName("th"),n=(s=i.getElementsByTagName("tr")).length,p=this.settings.useMapControls,e.hasClass("wb-tables")&&void 0===e.attr("data-wb-tables")&&e.attr("data-wb-tables",'{ "order": [], "columnDefs": [ { "targets": [ 0, '+(l.length+1)+' ], "orderable": false } ] }'),x=!1!==this.settings.tables[E].visible,r=l.length-1;-1!==r;--r)a[r]=l[r].innerHTML.replace(T,"");for(i=e.find("thead tr").get(0),t.zoom&&p&&((S=A.createElement("th")).innerHTML=k,i.insertBefore(S,i.firstChild)),(S=A.createElement("th")).innerHTML=C,i.appendChild(S),S=N(),S=void 0===t.style?{strokeColor:S.stroke,fillColor:S.fill}:t.style,n=s.length-1;-1!==n;--n){for(c={},y=(g=s[n]).getAttribute("data-type"),m=g.getElementsByTagName("td"),v=0;v<m.length;v+=1)(h=(u=m[v]).getElementsByTagName("script")[0])&&h.parentNode.removeChild(h),c[a[v]]=u.innerHTML;if(null!==y){if("bbox"===y){for(b=g.getAttribute("data-geometry").split(","),f="",w=(d=D(b[0],b[1],b[2],b[3])).length-1;-1!==w;--w)f+=d[w].getCoordinates()[0]+" "+d[w].getCoordinates()[1]+", ";b="POLYGON (("+(f=f.slice(0,-2))+"))"}else"wkt"===y&&-1!==(b=g.getAttribute("data-geometry")).indexOf("POINT")&&(b=b.replace(",",""));(y=O.readFeature(b,{dataProjection:"EPSG:4326",featureProjection:this.map.getView().getProjection()})).setId(V()),y.layerId=t.id,y.layerTitle=e.attr("aria-label"),t.tooltips&&(y.tooltip=t.tooltipText?c[t.tooltipText]:c[Object.keys(c)[0]]),g.setAttribute("id",y.getId().replace(P,"_")),g.insertCell(0).innerHTML=M(this,y),p&&t.zoom&&((g=g.insertCell(-1)).classList.add("text-right"),g.innerHTML=z(this,y)),y.attributes=c,o.push(y)}}S=new F(this,{tableId:e.attr("id"),type:"wkt",visible:x,datatable:t.datatable,popupsInfo:t.popupsInfo,popups:t.popups,tooltips:t.tooltips,tooltipText:t.tooltipText,name:t.id,title:e.attr("aria-label"),features:o,style:S}),this.mapLayers.push(S)}},h.prototype.addMapLayers=function(){var e,o,a=this;a.addTabularData(),L.each(a.settings.overlays,function(e,t){o=new F(a,t),a.mapLayers.push(o)}),(e=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba( 255, 0, 20, 0.1 )"}),stroke:new ol.style.Stroke({color:"#ff0033",width:2}),image:new ol.style.RegularShape({fill:new ol.style.Fill({color:"#ff0033"}),stroke:new ol.style.Stroke({color:"#ff0033",width:5}),points:4,radius:10,radius2:0,angle:0})})})).id="locLayer",a.map.addLayer(e);for(var t=a.mapLayers.length-1;-1!==t;--t)a.mapLayers[t].layer&&a.map.addLayer(a.mapLayers[t].layer)},F.prototype.populateDataTable=function(){if(this.settings.accessible){var e,t=this,o=t.settings.attributes,a=function(){var e,t=0;for(e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t+=1);return t}(),i="<table aria-label='"+t.settings.title+"' id='"+t.id+'\' data-wb-tables=\'{ "order": [], "columnDefs": [ { "targets": [ 0, '+(a+1)+" ], \"orderable\": false } ] }'class='table",a="'><caption>"+t.settings.caption+"</caption>",l="<th><span class='wb-inv'>"+j.select+"</span></th>",r="",s=t.layer.getSource().getFeatures();for(e in t.settings.datatable?i+=" wb-tables":i+=" table-condensed",o)Object.prototype.hasOwnProperty.call(o,e)&&(l+="<th>"+(o[e].alias||o[e])+"</th>");l="<thead><tr>"+l+(t.map.settings.useMapControls&&t.settings.zoom?"<th><span class='wb-inv'>"+j.zoomFeature+"</span></th>":"")+"</tr></thead>";for(var n=0;n<s.length;n+=1){for(e in r+="<tr><td>"+M(t,s[n]),o=s[n].attributes)Object.prototype.hasOwnProperty.call(o,e)&&(r+="<td>"+o[e]+"</td>");r+=t.map.settings.useMapControls&&t.settings.zoom?"<td class='text-right'>"+z(t.map,s[n]):""}return a=L(i+a+l+"<tbody>"+r+"</tbody></table>"),L("div[ data-layer='"+t.id+"'].geomap-table-wrapper").append(a),t.map,L(".wb-tables").trigger("wb-init.wb-tables"),a}},F.prototype.createOLLayer=function(){var r,t,s,n,e,o,b,a,i,f,l,p,v=this,w=v.settings.attributes;return"wms"===v.settings.type?(o=(e=function(e){var t,o={};for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&"type"!==t&&"caption"!==t&&"url"!==t&&"title"!==t&&(o[t]=e[t]);return o}(v.settings)).options.opacity||1,b=new ol.layer.Image({opacity:o,visible:v.settings.visible,source:new ol.source.ImageWMS({url:v.settings.url,params:e})}),v.settings.accessible=!1):"esritile"===v.settings.type?(l={url:v.settings.url,params:v.settings.params},b=new ol.layer.Tile({visible:v.settings.visible,source:new ol.source.TileArcGISRest(l)}),v.settings.accessible=!1):"wkt"===v.settings.type?(i=new c,b=new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({features:v.settings.features}),style:i.createStyleFunction(v.settings.style,v.settings.featureType)}),v.settings.accessible=!1):"kml"===v.settings.type?(a=!v.settings.style,i=new c,p=N(),b=new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({url:v.settings.url,format:new ol.format.KML({extractStyles:a})})}),void 0===v.settings.style&&(v.settings.style={strokeColor:p.stroke,fillColor:p.fill}),b.getSource().once("addfeature",function(e){t=e.feature.getGeometry().getType(),a||(e=i.createStyleFunction(v.settings.style,t),b.setStyle(e))}),n=b.getSource(),s=n.on("change",function(){if("ready"===n.getState()){n.unByKey(s);for(var e=this.getFeatures(),t=0,o=e.length;t<o;t+=1){var a,i,l=e[t];for(i in v.settings.style.select&&(v.settings.style.select.type="select",a=(new c).createStyleFunction(v.settings.style.select,l.getGeometry().getType()),l.selectStyle=a),l.setId(V()),l.layerId=b.id,l.layerTitle=b.title,r={},w)Object.prototype.hasOwnProperty.call(w,i)&&(r[w[i]]=l.getProperties()[i]);l.attributes=r,v.settings.tooltips&&(l.tooltip=v.settings.tooltipText?r[v.settings.tooltipText]:r[Object.keys(r)[0]])}v.populateDataTable(),v.map.legend.symbolize(v)}},n)):"json"===v.settings.type?(f=new ol.source.Vector,i=new c,p=N(),void 0===v.settings.style&&(v.settings.style={strokeColor:p.stroke,fillColor:p.fill}),b=v.settings.cluster?new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Cluster({distance:40,source:f})}):new ol.layer.Vector({visible:v.settings.visible,source:f}),f.once("addfeature",function(){b.setStyle(i.createStyleFunction(v.settings.style,t))}),l=function(e){var t,o,a,i,l,r,s,n,p,c=v.settings.root,g=e[c]||e.features||e;for(g instanceof Array==!1&&(g=L.map(g,function(e){return e})),s=0,n=g.length;s<n;s+=1)if((a=g[s])[r=r||function(e){var o;return L.each(e,function(e,t){t.coordinates&&(o=e)}),o}(a)]){if(l=a[r].coordinates[0],Object.values(a[r]).includes("Polygon")&&5===l.length){for(var d=[],u=0,m=(o=D(l[1][0],l[1][1],l[3][0],l[3][1])).length;u<m;u+=1){var y=o[u];d.push(y.getCoordinates())}i=new ol.geom.Polygon([d])}else Object.values(a[r]).includes("Point")?i=new ol.geom.Point([a[r].coordinates[0],a[r].coordinates[1]]):Object.values(a[r]).includes("LineString")&&(i=new ol.geom.LineString(a[r].coordinates));for(var h in l=i.transform("EPSG:4326",v.map.map.getView().getProjection()),t={},w)Object.prototype.hasOwnProperty.call(w,h)&&((p=w[h].path)?t[w[h].alias]=a[p]?a[p][h]:"":t[w[h]]=a[h]||"");(a=new ol.Feature).setId(V()),a.layerId=b.id,a.layerTitle=b.title,a.attributes=t,a.setGeometry(l),f.addFeature(a),v.settings.tooltips&&(a.tooltip=v.settings.tooltipText?t[v.settings.tooltipText]:t[Object.keys(t)[0]])}v.populateDataTable(),v.map.legend.symbolize(v)},L.getJSON(v.settings.url,v.settings.params,l)):"geojson"!==v.settings.type&&"esrijson"!==v.settings.type&&"topojson"!==v.settings.type||(i=new c,p=N(),void 0===v.settings.style&&(v.settings.style={strokeColor:p.stroke,fillColor:p.fill}),p=v.settings.params?v.settings.url+"?"+L.param(v.settings.params):v.settings.url,(b="geojson"===v.settings.type?new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({url:p,format:new ol.format.GeoJSON,strategy:ol.loadingstrategy.bbox})}):"topojson"===v.settings.type?new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({url:p,format:new ol.format.TopoJSON})}):new ol.layer.Vector({visible:v.settings.visible,source:new ol.source.Vector({url:p,format:new ol.format.EsriJSON,strategy:ol.loadingstrategy.bbox})})).getSource().once("addfeature",function(e){t=e.feature.getGeometry().getType();e=i.createStyleFunction(v.settings.style,t);b.setStyle(e)}),n=b.getSource(),s=n.on("change",function(){if("ready"===n.getState()){n.unByKey(s);for(var e=this.getFeatures(),t=0,o=e.length;t<o;t+=1){var a,i=e[t];for(a in i.setId(V()),i.layerId=b.id,i.layerTitle=b.title,r={},w)Object.prototype.hasOwnProperty.call(w,a)&&(r[w[a]]=i.getProperties()[a]);i.attributes=r,v.settings.tooltips&&(i.tooltip=v.settings.tooltipText?r[v.settings.tooltipText]:r[Object.keys(r)[0]])}v.populateDataTable(),v.map.legend.symbolize(v)}},n)),b?(b.id=v.id,b.title=v.settings.title,b.datatable=v.settings.datatable,b.popupsInfo=v.settings.popupsInfo,b.popups=v.settings.popups,b):null},h.prototype.loadControls=function(){var o,l,e,t,a,i,r,s,n,p,c=this,g=c.map,d=new ol.interaction.Select({layers:c.layers});d.getFeatures().on("remove",function(e){e=e.element;e.setStyle(null),L("#cb_"+e.getId()).prop("checked",!1).closest("tr").removeClass("active")}),d.getFeatures().on("add",function(e){e=e.element;e.selectStyle&&e.setStyle(e.selectStyle),L("#cb_"+e.getId()).prop("checked",!0).closest("tr").addClass("active")}),d.on("select",function(e){var t=e.selected||this.getFeatures();t&&0<t.length&&void 0!==t[0].layerTitle&&(o=G(this.getMap(),t[0].layerId).popups,t[0].layerTitle=this.getLayer(e.selected[0]).title,o&&u(0,t[0],g)),t&&0===t.length&&u(0,null,g)},d),g.getInteractions().extend([d]),c.settings.useMapControls&&((e=A.createElement("span")).className="glyphicon glyphicon-home",t=new ol.control.ZoomToExtent({extent:g.getView().calculateExtent(g.getSize()),label:e}),g.addControl(t),t.element.setAttribute("aria-label",j.zoomworld),t.element.setAttribute("title",j.zoomworld),c.settings.useMousePosition&&(a=new ol.control.MousePosition({coordinateFormat:ol.coordinate.createStringXY(4),projection:"EPSG:4326",undefinedHTML:""}),g.addControl(a),a.element.setAttribute("aria-label",j.mouseposition),a.element.setAttribute("title",j.mouseposition)),c.settings.useScaleLine&&(i=new ol.control.ScaleLine,g.addControl(i),i.element.setAttribute("aria-label",j.scaleline),i.element.setAttribute("title",j.scaleline))),c.settings.useGeocoder&&new m(c),c.settings.useAOI&&(l=c,s=new ol.interaction.DragBox,n=new ol.proj.Projection({code:"EPSG:4326"}),p=l.map.getView().getProjection(),s.on("boxend",function(){var e=s.getGeometry().transform(p,n).getExtent();r=I(l,e),l.map.getView().fit(r.getGeometry().getExtent(),l.map.getSize()),L("#geomap-aoi-minx-"+l.id).val(e[0].toFixed(6)),L("#geomap-aoi-maxx-"+l.id).val(e[2].toFixed(6)),L("#geomap-aoi-maxy-"+l.id).val(e[3].toFixed(6)),L("#geomap-aoi-miny-"+l.id).val(e[1].toFixed(6)),L("#geomap-aoi-extent-"+l.id).val(r.getGeometry().getExtent()).trigger("change"),L("#geomap-aoi-extent-lonlat-"+l.id).val(e[0]+", "+e[1]+", "+e[2]+", "+e[3]).trigger("change")}),s.on("boxstart",function(){G(l.map,"locLayer").getSource().clear(!0)}),l.map.addInteraction(s),s.setActive(!1),l.settings.useAOIOpen?l.mapDiv.before("<div class='geomap-aoi panel panel-default'><div id='geomap-aoi-"+l.id+"' class='panel-body'></div></div>"):l.mapDiv.before("<details class='geomap-aoi'><summary>"+j.aoiTitle+"</summary><div id='geomap-aoi-"+l.id+"'></div></details>"),L("#geomap-aoi-"+l.id).append("<fieldset id='form-aoi-"+l.id+"'><legend tabindex='-1'>"+j.aoiInstructions+"</legend><div class='row'><div class='col-md-2 form-group'><label for='geomap-aoi-maxy-"+l.id+"' class='wb-inv'>"+j.aoiNorth+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+j.aoiNorth.charAt(0)+"</span><input type='number' id='geomap-aoi-maxy-"+l.id+"' placeholder='90' class='form-control input-sm' min='-90' max='90' step='0.000001'></input></div></div><div class='col-md-2 form-group'><label for='geomap-aoi-maxx-"+l.id+"' class='wb-inv'>"+j.aoiEast+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+j.aoiEast.charAt(0)+"</span><input type='number' id='geomap-aoi-maxx-"+l.id+"' placeholder='180' class='form-control input-sm' min='-180' max='180' step='0.000001'></input> </div></div><div class='col-md-2 form-group'><label for='geomap-aoi-miny-"+l.id+"' class='wb-inv'>"+j.aoiSouth+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+j.aoiSouth.charAt(0)+"</span><input type='number' id='geomap-aoi-miny-"+l.id+"' placeholder='-90' class='form-control input-sm' min='-90' max='90' step='0.000001'></input> </div></div><div class='col-md-2 form-group'><label for='geomap-aoi-minx-"+l.id+"' class='wb-inv'>"+j.aoiWest+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+j.aoiWest.charAt(0)+"</span><input type='number' id='geomap-aoi-minx-"+l.id+"' placeholder='-180' class='form-control input-sm' min='-180' max='180' step='0.000001'></input> </div></div><div class='col-md-4'><button class='btn btn-default btn-sm' id='geomap-aoi-btn-draw-"+l.id+"'>"+j.add+"</button> <button class='btn btn-default btn-sm' id='geomap-aoi-btn-clear-"+l.id+"'>"+j.aoiBtnClear+"</button> </div></div><input type='hidden' id='geomap-aoi-extent-"+l.id+"'></input><input type='hidden' id='geomap-aoi-extent-lonlat-"+l.id+"'></input></fieldset>"),L("#geomap-aoi-btn-clear-"+l.id).after("<button id='geomap-aoi-toggle-mode-draw-"+l.id+"' href='#' class='btn btn-sm btn-default geomap-geoloc-aoi-btn' title='"+j.aoiBtnDraw+"'><i class='glyphicon glyphicon-edit'></i> "+j.aoiBtnDraw+"</button>"),w.on("click","#geomap-aoi-toggle-mode-draw-"+l.id,function(e){e.preventDefault();var t=v(l.map,ol.interaction.DragBox),o=v(l.map,ol.interaction.Select),a=s.getActive(),e=L("#geomap-aoi-"+l.id);L(this).toggleClass("active"),a||e.find("legend").trigger("setfocus.wb"),t.setActive(!a),o.setActive(a)}),w.on("click","#geomap-aoi-btn-clear-"+l.id,function(e){e.preventDefault(),L("#geomap-aoi-extent-"+l.id).val(""),L("#geomap-aoi-extent-lonlat-"+l.id).val(""),L("#geomap-aoi-minx-"+l.id).val("").parent().removeClass("has-error"),L("#geomap-aoi-miny-"+l.id).val("").parent().removeClass("has-error"),L("#geomap-aoi-maxx-"+l.id).val("").parent().removeClass("has-error"),L("#geomap-aoi-maxy-"+l.id).val("").parent().removeClass("has-error"),G(l.map,"locLayer").getSource().clear(!0)}),w.on("click","#geomap-aoi-btn-draw-"+l.id,function(e){e.preventDefault(),L("#geomap-aoi-extent-"+l.id).val(""),L("#geomap-aoi-extent-lonlat-"+l.id).val(""),L("#geomap-aoi-minx-"+l.id).parent().removeClass("has-error"),L("#geomap-aoi-maxx-"+l.id).parent().removeClass("has-error"),L("#geomap-aoi-maxy-"+l.id).parent().removeClass("has-error"),L("#geomap-aoi-miny-"+l.id).parent().removeClass("has-error"),G(l.map,"locLayer").getSource().clear(!0);var t=parseFloat(L("#geomap-aoi-minx-"+l.id).val()),o=parseFloat(L("#geomap-aoi-miny-"+l.id).val()),a=parseFloat(L("#geomap-aoi-maxx-"+l.id).val()),i=parseFloat(L("#geomap-aoi-maxy-"+l.id).val()),e=!0;if((!t||t<-180||180<t)&&(L("#geomap-aoi-minx-"+l.id).parent().addClass("has-error"),e=!1),(!a||a<-180||180<a)&&(L("#geomap-aoi-maxx-"+l.id).parent().addClass("has-error"),e=!1),(!i||i<-90||90<i)&&(L("#geomap-aoi-maxy-"+l.id).parent().addClass("has-error"),e=!1),(!o||o<-90||90<o)&&(L("#geomap-aoi-miny-"+l.id).parent().addClass("has-error"),e=!1),!1===e)return!1;e=I(l,[t,o,a,i]),l.map.getView().fit(e.getGeometry().getExtent(),l.map.getSize()),L("#geomap-aoi-extent-"+l.id).val(e.getGeometry().getExtent()).trigger("change"),L("#geomap-aoi-extent-lonlat-"+l.id).val(t+", "+o+", "+a+", "+i).trigger("change")}),l.aoiExtent&&(e=(d=l.aoiExtent.split(","))[0].trim(),t=d[1].trim(),a=d[2].trim(),i=d[3].trim(),r=I(l,d),l.map.getView().fit(r.getGeometry().getExtent(),l.map.getSize()),L("#geomap-aoi-minx-"+l.id).val(e),L("#geomap-aoi-maxx-"+l.id).val(a),L("#geomap-aoi-maxy-"+l.id).val(i),L("#geomap-aoi-miny-"+l.id).val(t),L("#geomap-aoi-extent-"+l.id).val(r.getBounds().toBBOX()),L("#geomap-aoi-extent-lonlat-"+l.id).val(e+", "+t+", "+a+", "+i))),c.settings.useGeolocation&&c.map.addControl(new y({projection:c.map.getView().getProjection()}))},h.prototype.createPopup=function(){var t,e=L("<div id='popup-"+this.mapDiv.attr("id")+"' class='ol-popup'></div>"),o=L("<a href='#' title='"+j.dismiss+"' class='ol-popup-closer' role='button'>&#xd7;<span class='wb-inv'>"+j.dismiss+"</span></a>");e.append(o,"<div class='popup-content'></div>"),L("#"+this.mapDiv.attr("id")).append(e),t=new ol.Overlay({element:A.getElementById("popup-"+this.mapDiv.attr("id")),autoPan:!0,autoPanAnimation:{duration:250}}),o.on("click",function(e){return e.preventDefault(),t.setPosition(void 0),this.blur(),!1}),this.map.addOverlay(t)},h.prototype.accessibilize=function(){var e=this,t=e.mapDiv.find(".ol-zoom-in"),o=e.mapDiv.find(".ol-zoom-out");t.attr("aria-label",j.zoomin),t.attr("title",j.zoomin),o.attr("aria-label",j.zoomout),o.attr("title",j.zoomout),e.mapDiv.attr({tabindex:"0","data-map":e.id}),e.mapDiv.attr({role:"dialog","aria-label":j.ariaMap}),e.settings.useMapControls&&new a(e)},h.prototype.zoomAOI=function(e,t,o,a){var i,l=this.map,r=l.getView(),s="string"==typeof e;if(!s||e.length){if(s&&null!==e.substring(0,1).match(/[a-z]/gi))var n=(new ol.format.WKT).readFeature(e,{dataProjection:"EPSG:4326",featureProjection:r.getProjection()});else{if(!t&&s){if(4!==(i=e.split(" ")).length)throw"4 cardinal point must be provided";e=i[0],t=i[1],o=i[2],a=i[3]}else if(!t||!o||!a)throw"Cardinal point must be provided";i=[parseFloat(a),parseFloat(o),parseFloat(t),parseFloat(e)],n=I(this,i,!0)}n=n.getGeometry().getExtent(),r.fit(n,l.getSize())}else r.setZoom(r.getMaxZoom)},h.prototype.showLayer=function(e,t){var o,a,i,l=[],r=this.mapLayers,s=r.length;for(t=!!t,Array.isArray(e)?l=e:l.push(e),o=0;o!==s;o+=1)i=(a=r[o]).layer.title,e&&-1===l.indexOf(i)?i&&(a.isVisible=!t):a.isVisible=t},b.prototype.symbolize=function(e){if(e.layer){var t,o,a,i,l,r,s,n,p=e.settings.style,c=e.id,g=e.layer.getSource().getFeatures()[0],d=[],u="",m="";if(void 0!==p&&p.rule){if(o=p.rule.length)for(l=0;l!==o;l+=1){if(t=(s=p.rule[l]).filter,a=s.init,m="",n="ls_"+c+"_"+l,t&&!s.name)if(t.name)m=t.name;else switch(t){case"EQUAL_TO":m=s.field+" = "+s.value[0];break;case"GREATER_THAN":m=s.field+" > "+s.value[0];break;case"LESS_THAN":m=s.field+" < "+s.value[0];break;case"BETWEEN":m=s.field+" "+s.value[0]+" - "+s.value[1]}else s&&s.name&&(m=s.name);u+="<li><div class='geomap-legend-element'><div id='"+n+"' class='geomap-legend-symbol'></div><span class='geomap-legend-symbol-text'><small>"+m+"</small></span></div></li>",d.push({id:n,feature:g,symbolizer:a})}}else if(void 0!==p&&"unique"===p.type)for(var y in l=0,p.init)u+="<li><div class='geomap-legend-element'><div id='"+(n="ls_"+c+"_"+l)+"' class='geomap-legend-symbol'></div><span class='geomap-legend-symbol-text'><small>"+(m=(a=p.init[y]).name||y)+"</small></span></div></li>",d.push({id:n,feature:g,symbolizer:a}),l+=1;else void 0!==p&&"symbol"===p.type?u+="<li><div class='geomap-legend-element'><div id='"+(n="ls_"+c+"_0")+"' class='geomap-legend-symbol'></div><span class='geomap-legend-symbol-text'><small>"+(m=(a=p.init).name||"")+"</small></span></div></li>":(n="ls_"+c+"_0",a={fillColor:p.fillColor,strokeColor:p.strokeColor,strokeWidth:p.strokeWidth,strokeDash:p.strokeDash},u+="<li><div class='geomap-legend-element'><div id='"+n+"' class='geomap-legend-symbol'></div><span class='geomap-legend-symbol-text'><small>"+m+"</small></span></div></li>"),d.push({id:n,feature:g,symbolizer:a});for(L("#sb_"+c).html("<ul class='list-unstyled'>"+u+"</ul>"),i=0,r=d.length;i!==r;i+=1){var h=d[i];this.getSymbol(h.id,h.feature,h.symbolizer)}}},b.prototype.getSymbol=function(e,t,o){var a,i,l,r=N(),s=t&&t.getGeometry()?t.getGeometry().getType():"Polygon",n=o.fillOpacity||o.graphicOpacity||1,p=o.fillColor?P(o.fillColor,n):r.transparent,c=o.pointRadius||5,g=o.strokeColor?P(o.strokeColor):r.transparent,d=o.strokeWidth||1,u=o.strokeDash||[1,0],m=o.externalGraphic||null,y=o.graphicName||null,h=o.graphicHeight||30,b=o.graphicWidth||30,f=h<2*c?2*c:h,v=b<2*c?2*c:b;switch(s){case"Polygon":a=new ol.Feature({geometry:new ol.geom.Polygon([[[-10,-7],[10,-7],[10,7],[-10,7]]])}),i=O({fill:new ol.style.Fill({color:p}),stroke:new ol.style.Stroke({color:g,width:d,lineDash:u})}),a.setStyle(i);break;case"Point":a=new ol.Feature({geometry:new ol.geom.Point([0,0])}),i=y?S({symbol:y,fill:new ol.style.Fill({color:p}),stroke:new ol.style.Stroke({color:g,lineDash:u}),radius:c}):m?k({src:m,opacity:n,size:[b,h]}):C({radius:c,fill:new ol.style.Fill({color:p}),stroke:new ol.style.Stroke({color:g,width:d,lineDash:u})}),a.setStyle(i);break;case"LineString":a=new ol.Feature({geometry:new ol.geom.LineString([[-9,-4],[-4,4],[4,-4],[9,4]])}),i=T({stroke:new ol.style.Stroke({color:g,width:d,lineDash:u})}),a.setStyle(i);break;default:a=new ol.Feature({geometry:new ol.geom.Polygon([[[-10,-7],[10,-7],[10,7],[-10,7]]])}),i=O({fill:new ol.style.Fill({color:p}),stroke:new ol.style.Stroke({color:g,width:d,lineDash:u})}),a.setStyle(i)}(t=new ol.Map({controls:[],interactions:[],layers:[new ol.layer.Vector({source:new ol.source.Vector})]}))&&(this.symbolMapArray.push(t),(l=t.getLayers().item(0).getSource()).clear(),l.addFeature(a)),t.setTarget(e),r=e,o=t,s=v,l=f,t=(e=a).getGeometry().getExtent(),v=ol.extent.getWidth(t),f=ol.extent.getHeight(t),e=L("#"+r),r=(r=1)||(Math.max(v/s||0,f/l||0)||1),o.setView(new ol.View({minResolution:r,maxResolution:r,projection:new ol.proj.Projection({code:"",units:"pixels"})})),v=(s=Math.max(s,v/r))*r/2,r=(f=Math.max(l,f/r))*r/2,r=[(t=ol.extent.getCenter(t))[0]-v,t[1]-r,t[0]+v,t[1]+r],e.width(Math.round(s)),e.height(Math.round(f)),o.updateSize(),o.getView().fit(r,o.getSize())},b.prototype.refresh=function(){if(0!==this.symbolMapArray.length)for(var e,t=this.symbolMapArray.length-1;-1!==t;--t)e=this.symbolMapArray[t],L("#"+e.getTarget()).is(":visible")&&e.updateSize()},ol.inherits(y,ol.control.Control),ol.inherits(a,ol.control.Control),ol.inherits(m,ol.control.Control),l.doc.on("submit",".wb-geomap-filter",function(e){e.preventDefault();var e=L(this),o=A.getElementById(e.data("bind-to")).geomap;e.find("select[data-filter]").each(function(){var e=L(this),t=e.find("option:selected").val(),e=e.attr("data-filter");"aoi"===e&&o.zoomAOI(t),"layer"===e&&o.showLayer(t,!0)})}),l.doc.on("click",".wb-geomap-filter [type=reset]",function(){var e=L(this.form),t=A.getElementById(e.data("bind-to")).geomap,o=t.map,a=o.getView();o.getView().fit(a.calculateExtent(o.getSize()),o.getSize()),e.find("select[data-filter=layer] option").each(function(){this.defaultSelected&&t.showLayer(this.value,!0)}),e.find("select[data-filter=aoi] option").each(function(){this.defaultSelected&&t.zoomAOI(this.value)})})}(jQuery,(window,document),wb);